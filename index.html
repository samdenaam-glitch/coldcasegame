<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cold Case Files - Detective Game</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500&family=Crimson+Text&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
</head>
<body>
    <!-- LOADING SCREEN -->
    <div id="loading-screen">
        <div class="loading-content">
            <h1><i class="fas fa-folder-open"></i> COLD CASE FILES</h1>
            <p class="loading-subtitle">Archived Investigations Division</p>
            <div class="loading-progress">
                <div class="loading-bar">
                    <div id="loading-bar-fill"></div>
                </div>
                <div id="loading-status">Initializing game engine...</div>
            </div>
            <div class="loading-tip">
                <i class="fas fa-lightbulb"></i>
                <span>Tip: Examine all evidence before drawing conclusions</span>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- HEADER -->
        <header class="game-header">
            <div class="header-left">
                <h1><i class="fas fa-folder-open"></i> COLD CASE FILES</h1>
                <p class="subtitle">Archived Investigations Division</p>
            </div>
            <div class="header-right">
                <div class="player-info">
                    <div class="player-rank">
                        <span class="rank-label">RANK:</span>
                        <span id="rank" class="rank-value">ROOKIE DETECTIVE</span>
                    </div>
                    <div class="player-stats">
                        <span class="stat" title="Cases Solved"><i class="fas fa-check-circle"></i> <span id="cases-solved">0</span></span>
                        <span class="stat" title="Cold Case Points"><i class="fas fa-star"></i> <span id="ccp">100</span> CCP</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- MAIN GAME AREA -->
        <main class="game-main">
            <!-- LEFT PANEL: CASE EVIDENCE -->
            <section class="panel evidence-panel">
                <div class="panel-header">
                    <h2><i class="fas fa-box-archive"></i> CASE EVIDENCE</h2>
                    <div class="case-info">
                        <span id="case-id">CCF-1987-045</span>
                        <span id="case-year">1987</span>
                        <span id="case-difficulty" class="difficulty-beginner">BEGINNER</span>
                    </div>
                </div>
                
                <div class="panel-content">
                    <!-- CASE TITLE -->
                    <div class="case-title-container">
                        <h3 id="case-title">THE VANISHING VIOLINIST</h3>
                        <p id="case-summary" class="case-summary">
                            Renowned violinist Evelyn Vance disappeared after her final performance at the Royal Symphony Hall on November 15, 1987. No ransom note, no witnesses, just an empty dressing room and a broken violin string.
                        </p>
                    </div>
                    
                    <!-- EVIDENCE TABS -->
                    <div class="evidence-tabs">
                        <button class="tab-btn active" data-tab="photos"><i class="fas fa-camera"></i> PHOTOS</button>
                        <button class="tab-btn" data-tab="documents"><i class="fas fa-file-alt"></i> DOCUMENTS</button>
                        <button class="tab-btn" data-tab="forensics"><i class="fas fa-microscope"></i> FORENSICS</button>
                    </div>
                    
                    <!-- EVIDENCE CONTENT -->
                    <div class="evidence-content">
                        <!-- Photos Tab Content -->
                        <div id="photos-tab" class="tab-content active">
                            <div class="evidence-grid">
                                <!-- Evidence items will be loaded dynamically -->
                            </div>
                        </div>
                        
                        <!-- Documents Tab Content -->
                        <div id="documents-tab" class="tab-content">
                            <div class="document-list">
                                <!-- Document items will be loaded dynamically -->
                            </div>
                        </div>
                        
                        <!-- Forensics Tab Content -->
                        <div id="forensics-tab" class="tab-content">
                            <div class="forensics-list">
                                <!-- Forensic items will be loaded dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- RIGHT PANEL: WITNESSES & NOTES -->
            <section class="panel interaction-panel">
                <!-- WITNESSES SECTION -->
                <div class="witness-section">
                    <div class="panel-header">
                        <h2><i class="fas fa-user-check"></i> WITNESS STATEMENTS</h2>
                    </div>
                    
                    <div class="witness-container">
                        <div class="witness active" data-witness="stage-manager">
                            <div class="witness-header">
                                <h3><i class="fas fa-user-tie"></i> STAGE MANAGER</h3>
                                <span class="witness-role">Carlos Mendoza</span>
                            </div>
                            <div class="witness-testimony">
                                <p>Loading witness testimony...</p>
                            </div>
                            <div class="witness-questions">
                                <h4>QUESTIONS TO ASK:</h4>
                                <div class="question-buttons">
                                    <button class="question-btn" data-question="1" data-witness-index="0" data-question-index="0">What did you see?</button>
                                    <button class="question-btn" data-question="2" data-witness-index="0" data-question-index="1">Did you hear anything unusual?</button>
                                    <button class="question-btn" data-question="3" data-witness-index="0" data-question-index="2">Was anything out of place?</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="witness" data-witness="understudy">
                            <div class="witness-header">
                                <h3><i class="fas fa-music"></i> UNDERSTUDY</h3>
                                <span class="witness-role">Melissa Chen</span>
                            </div>
                            <div class="witness-testimony">
                                <p>Loading witness testimony...</p>
                            </div>
                            <div class="witness-questions">
                                <h4>QUESTIONS TO ASK:</h4>
                                <div class="question-buttons">
                                    <button class="question-btn" data-question="4" data-witness-index="1" data-question-index="0">Did the victim seem worried?</button>
                                    <button class="question-btn" data-question="5" data-witness-index="1" data-question-index="1">Who was she talking to?</button>
                                    <button class="question-btn" data-question="6" data-witness-index="1" data-question-index="2">Any recent conflicts?</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Witness Toggle -->
                        <div class="witness-nav">
                            <button id="prev-witness" class="nav-btn"><i class="fas fa-chevron-left"></i> Previous</button>
                            <span class="witness-counter">Witness 1 of 2</span>
                            <button id="next-witness" class="nav-btn">Next <i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
                
                <!-- NOTES & SOLVE SECTION -->
                <div class="notes-section">
                    <div class="panel-header">
                        <h2><i class="fas fa-clipboard"></i> DETECTIVE'S NOTEPAD</h2>
                    </div>
                    
                    <div class="notes-container">
                        <textarea id="detective-notes" placeholder="Record your observations, theories, and clues here... 
                        
Example:
- Broken violin string suggests struggle
- Threat letter received day before
- Witness saw arguing man
- Blue fibers on string..."></textarea>
                        
                        <div class="clue-highlights">
                            <h4>KEY CLUES IDENTIFIED:</h4>
                            <ul id="clue-list">
                                <li><i class="fas fa-check-circle"></i> Broken violin string</li>
                                <li><i class="fas fa-check-circle"></i> Anonymous threat letter</li>
                                <li><i class="far fa-circle"></i> Blue fibers on string</li>
                                <li><i class="far fa-circle"></i> Unidentified fingerprints</li>
                            </ul>
                        </div>
                        
                        <div class="action-buttons">
                            <button id="hint-btn" class="action-btn hint-btn">
                                <i class="fas fa-lightbulb"></i> GET HINT (25 CCP)
                            </button>
                            <button id="solve-btn" class="action-btn solve-btn">
                                <i class="fas fa-check-double"></i> SOLVE CASE
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- FOOTER -->
        <footer class="game-footer">
            <div class="case-progress">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 40%"></div>
                </div>
                <span class="progress-text">INVESTIGATION PROGRESS: 40%</span>
            </div>
            <div class="footer-controls">
                <button id="select-case-btn" class="footer-btn"><i class="fas fa-folder-open"></i> SELECT CASE</button>
                <button id="new-case-btn" class="footer-btn"><i class="fas fa-forward"></i> NEXT CASE</button>
                <button id="save-btn" class="footer-btn"><i class="fas fa-save"></i> SAVE</button>
                <button id="load-btn" class="footer-btn"><i class="fas fa-folder-open"></i> LOAD</button>
                <button id="help-btn" class="footer-btn"><i class="fas fa-question-circle"></i> HELP</button>
            </div>
        </footer>
    </div>

    <!-- CASE SELECTION MODAL -->
    <div id="case-selection-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-folder-open"></i> CASE ARCHIVES</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="case-selection-stats">
                    <div class="case-stat">
                        <div class="stat-value" id="total-cases-count">0</div>
                        <div class="stat-label">Total Cases</div>
                    </div>
                    <div class="case-stat">
                        <div class="stat-value" id="available-cases-count">0</div>
                        <div class="stat-label">Available</div>
                    </div>
                    <div class="case-stat">
                        <div class="stat-value" id="solved-cases-count">0</div>
                        <div class="stat-label">Solved</div>
                    </div>
                </div>
                
                <div class="case-selection-container">
                    <div id="case-list-container">
                        <!-- Cases will be loaded here dynamically -->
                    </div>
                </div>
                
                <div class="case-selection-actions">
                    <button id="close-case-select" class="action-btn hint-btn">
                        <i class="fas fa-times"></i> CLOSE
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SOLVE CASE MODAL -->
    <div id="solve-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-gavel"></i> SUBMIT YOUR SOLUTION</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="solution-form">
                    <div class="form-group">
                        <label for="culprit-select">PRIMARY SUSPECT:</label>
                        <select id="culprit-select">
                            <option value="">Select a suspect...</option>
                            <option value="rival">Rival Musician - Adrian Volkov</option>
                            <option value="manager">Stage Manager - Carlos Mendoza</option>
                            <option value="understudy">Understudy - Melissa Chen</option>
                            <option value="unknown">Unknown Intruder</option>
                            <option value="other">Other (specify in notes)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="motive-select">MOTIVE:</label>
                        <select id="motive-select">
                            <option value="">Select a motive...</option>
                            <option value="jealousy">Professional Jealousy</option>
                            <option value="revenge">Personal Revenge</option>
                            <option value="financial">Financial Gain</option>
                            <option value="accident">Accidental Cover-up</option>
                            <option value="other">Other (specify in notes)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="method-select">METHOD:</label>
                        <select id="method-select">
                            <option value="">Select method...</option>
                            <option value="kidnap">Forced Kidnapping</option>
                            <option value="voluntary">Willing Disappearance</option>
                            <option value="harm">Foul Play</option>
                            <option value="other">Other (specify in notes)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="final-theory">FINAL THEORY:</label>
                        <textarea id="final-theory" placeholder="Explain your reasoning based on the evidence...
                        
â€¢ How was the crime committed?
â€¢ What evidence supports your theory?
â€¢ Any unanswered questions?"></textarea>
                    </div>
                    
                    <button id="submit-solution" class="submit-btn">
                        <i class="fas fa-paper-plane"></i> SUBMIT SOLUTION
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- HINT MODAL -->
    <div id="hint-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-lightbulb"></i> INVESTIGATION HINT</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="hint-content">
                    <p id="hint-text">Examine the concert program more carefully. The annotations may reveal a hidden message.</p>
                    <div class="hint-cost">
                        <p><i class="fas fa-star"></i> This hint will cost <strong>25 Cold Case Points</strong>.</p>
                        <p class="hint-warning"><i class="fas fa-exclamation-triangle"></i> You currently have <span id="current-ccp">100</span> CCP</p>
                        <button id="confirm-hint" class="confirm-btn">
                            <i class="fas fa-check"></i> CONFIRM PURCHASE
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RESULTS MODAL (Will be injected by JavaScript) -->

    <!-- TUTORIAL MODAL (Will be injected by JavaScript) -->

    <!-- Load JavaScript files -->
    <script src="utils/save-manager.js"></script>
    <script src="game.js"></script>
    
    <!-- Game Initialization -->
    <script>
        // Initialize game when everything is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Cold Case Files - Starting initialization...');
            
            // Show loading screen
            const loadingScreen = document.getElementById('loading-screen');
            const loadingBarFill = document.getElementById('loading-bar-fill');
            const loadingStatus = document.getElementById('loading-status');
            const loadingTips = [
                "Tip: Click on evidence to discover clues",
                "Tip: Interview all witnesses for complete information",
                "Tip: Take notes in your detective's notepad",
                "Tip: Use hints when stuck, but they cost CCP",
                "Tip: Perfect solves improve your detective rank"
            ];
            
            let progress = 0;
            let currentTip = 0;
            
            // Show random tip
            const tipElement = document.querySelector('.loading-tip span');
            if (tipElement) {
                currentTip = Math.floor(Math.random() * loadingTips.length);
                tipElement.textContent = loadingTips[currentTip];
                
                // Rotate tips every 3 seconds
                setInterval(() => {
                    currentTip = (currentTip + 1) % loadingTips.length;
                    tipElement.textContent = loadingTips[currentTip];
                }, 3000);
            }
            
            // Simulate loading progress
            const interval = setInterval(() => {
                progress += Math.random() * 15 + 5; // 5-20% each step
                if (progress > 100) progress = 100;
                
                loadingBarFill.style.width = progress + '%';
                
                // Update status messages
                if (progress <= 25) {
                    loadingStatus.textContent = 'Loading game engine...';
                } else if (progress <= 50) {
                    loadingStatus.textContent = 'Loading case files...';
                } else if (progress <= 75) {
                    loadingStatus.textContent = 'Initializing interface...';
                } else {
                    loadingStatus.textContent = 'Finalizing setup...';
                }
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Start the game
                    setTimeout(() => {
                        initGame().then((success) => {
                            if (success) {
                                // Hide loading screen with fade out
                                loadingScreen.style.opacity = '0';
                                setTimeout(() => {
                                    loadingScreen.style.display = 'none';
                                    console.log('âœ… Game ready to play!');
                                    
                                    // Show welcome notification
                                    setTimeout(() => {
                                        if (typeof showNotification === 'function') {
                                            showNotification('ðŸ” Welcome to Cold Case Files! Start your investigation.', 'info');
                                        }
                                    }, 500);
                                }, 500);
                            } else {
                                // Show error
                                loadingStatus.textContent = 'Failed to initialize game. Please refresh.';
                                loadingStatus.style.color = '#e74c3c';
                            }
                        });
                    }, 500);
                }
            }, 300);
            
            // Handle page visibility
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible') {
                    console.log('ðŸ”„ Page is now visible');
                    // Resume any paused game logic
                }
            });
            
            // Handle before unload (save on exit)
            window.addEventListener('beforeunload', function(e) {
                // Check if there's unsaved progress
                if (typeof gameState !== 'undefined' && gameState.investigationProgress > 0) {
                    // Try to save
                    if (typeof saveGameState === 'function') {
                        try {
                            saveGameState();
                        } catch (err) {
                            console.log('Could not save before exit:', err);
                        }
                    }
                }
            });
        });
        
        // Handle keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Only trigger if not typing in textarea
            if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'INPUT') {
                return;
            }
            
            // Escape closes modals
            if (e.key === 'Escape') {
                const openModals = document.querySelectorAll('.modal.active');
                if (openModals.length > 0) {
                    if (typeof closeAllModals === 'function') {
                        closeAllModals();
                    }
                }
            }
            
            // Ctrl/Cmd + S saves game
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                if (typeof saveGameState === 'function') {
                    saveGameState();
                    if (typeof showNotification === 'function') {
                        showNotification('ðŸ’¾ Game saved!', 'info');
                    }
                }
            }
            
            // Ctrl/Cmd + O opens case selection
            if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
                e.preventDefault();
                const selectBtn = document.getElementById('select-case-btn');
                if (selectBtn) {
                    selectBtn.click();
                }
            }
            
            // Number keys switch tabs
            if (e.key >= '1' && e.key <= '3') {
                const tabNames = ['photos', 'documents', 'forensics'];
                const tabIndex = parseInt(e.key) - 1;
                if (tabIndex < tabNames.length && typeof switchTab === 'function') {
                    switchTab(tabNames[tabIndex]);
                }
            }
        });
        
        // Handle online/offline status
        window.addEventListener('online', function() {
            if (typeof showNotification === 'function') {
                showNotification('ðŸŒ Connection restored.', 'info');
            }
        });
        
        window.addEventListener('offline', function() {
            if (typeof showNotification === 'function') {
                showNotification('âš ï¸ You are offline. Some features may be limited.', 'error');
            }
        });
    </script>
    
    <!-- Add loading screen styles -->
    <style>
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0a1929;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loading-content {
            text-align: center;
            max-width: 500px;
            padding: 40px;
        }
        
        .loading-content h1 {
            color: #4a90e2;
            font-family: 'Crimson Text', serif;
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .loading-subtitle {
            color: #8a9ba8;
            font-size: 14px;
            margin-bottom: 40px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .loading-progress {
            width: 100%;
            margin-bottom: 30px;
        }
        
        .loading-bar {
            width: 100%;
            height: 6px;
            background-color: #152232;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        #loading-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #152232, #4a90e2, #4a90e2);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        #loading-status {
            color: #8a9ba8;
            font-size: 13px;
            font-family: 'Roboto Mono', monospace;
        }
        
        .loading-tip {
            background-color: rgba(245, 166, 35, 0.1);
            border: 1px solid rgba(245, 166, 35, 0.3);
            border-radius: 5px;
            padding: 15px;
            margin-top: 30px;
            color: #f5a623;
            font-size: 13px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .loading-tip i {
            font-size: 16px;
        }
        
        /* Case selection modal additional styles */
        .case-selection-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #152232;
            border-radius: 5px;
            border: 1px solid #2c3e50;
        }
        
        .case-stat {
            text-align: center;
            flex: 1;
        }
        
        .case-stat .stat-value {
            font-size: 24px;
            color: #4a90e2;
            font-weight: bold;
            font-family: 'Roboto Mono', monospace;
        }
        
        .case-stat .stat-label {
            font-size: 12px;
            color: #8a9ba8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .case-selection-container {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .case-selection-actions {
            text-align: center;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .loading-content {
                padding: 20px;
            }
            
            .loading-content h1 {
                font-size: 28px;
            }
            
            .case-selection-stats {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</body>
</html>